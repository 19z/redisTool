# Redis å·¥å…·åº“ - å®Œæˆæ€»ç»“

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

å·²æˆåŠŸå®ç°åŠŸèƒ½å®Œæ•´çš„ Redis å·¥å…·åº“ï¼ŒåŒ…å«å®Œå–„çš„å•å…ƒæµ‹è¯•ï¼ˆè¦†ç›–ç‡ â‰¥ 90%ï¼‰å’Œæ–‡æ¡£ã€‚

## âœ… å·²å®ç°åŠŸèƒ½

### 1. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

#### æ•°æ®ç»“æ„
- âœ… **RedisList** - åˆ—è¡¨æ“ä½œï¼ˆæ”¯æŒæ³›å‹ `RedisTypeList[T]`ï¼‰
- âœ… **RedisSet** - é›†åˆæ“ä½œï¼ˆæ”¯æŒæ³›å‹ `RedisTypeSet[T]`ï¼‰
- âœ… **RedisMap** - å“ˆå¸Œè¡¨æ“ä½œï¼ˆæ”¯æŒæ³›å‹ `RedisTypeMap[T]` å’Œ `RedisNumberMap`ï¼‰
- âœ… **RedisZSet** - æœ‰åºé›†åˆæ“ä½œï¼ˆæ”¯æŒæ³›å‹ `RedisTypeZSet[T]`ï¼‰

#### é«˜çº§åŠŸèƒ½
- âœ… **Queue** - é˜Ÿåˆ—ç³»ç»Ÿï¼ˆå»¶è¿Ÿä»»åŠ¡ã€é”™è¯¯é‡è¯•ã€å¤šå·¥ä½œçº¿ç¨‹ï¼‰
- âœ… **Cache** - ç¼“å­˜ç³»ç»Ÿï¼ˆè‡ªåŠ¨è¿‡æœŸç®¡ç†ã€TTL æ§åˆ¶ï¼‰
- âœ… **Lock** - åˆ†å¸ƒå¼é”ï¼ˆé˜»å¡/éé˜»å¡ã€è‡ªåŠ¨åˆ·æ–°ã€è¶…æ—¶æ§åˆ¶ï¼‰

#### è¾…åŠ©å·¥å…·
- âœ… **LastUseTime** - æ—¶é—´è¿½è¸ª
- âœ… **AcrossMinute / AcrossTime** - è·¨æ—¶é—´æ®µæ£€æµ‹
- âœ… **SafeTypeMap** - å®‰å…¨ç±»å‹æ˜ å°„

### 2. æ ¸å¿ƒç‰¹æ€§

#### Builder æ¨¡å¼
```go
redis := redisTool.Builder("127.0.0.1:6379", "password").
    Config(redisTool.Config{
        Prefix: "myapp:",
        MaxIdle: 10,
        MaxActive: 100,
    }).
    Build()
```

#### çµæ´»çš„åºåˆ—åŒ–
- è‡ªåŠ¨è¯†åˆ«å®ç° `Serializer` æ¥å£çš„ç±»å‹
- æ”¯æŒåŸºæœ¬ç±»å‹ï¼ˆstring, int, float, bool ç­‰ï¼‰
- å…¶ä»–ç±»å‹ä½¿ç”¨ gob ç¼–ç 
- å¯è‡ªå®šä¹‰åºåˆ—åŒ–å™¨

#### ç±»å‹å®‰å…¨
æ‰€æœ‰æ•°æ®ç»“æ„æ”¯æŒæ³›å‹ï¼Œæä¾›ç±»å‹å®‰å…¨çš„æ“ä½œã€‚

## ğŸ”§ å…¨å±€å‡½æ•°è§£å†³æ–¹æ¡ˆ

### é—®é¢˜èƒŒæ™¯
Go è¯­è¨€ä¸­ï¼Œ**æ–¹æ³•ä¸èƒ½æœ‰ç±»å‹å‚æ•°**ï¼Œåªæœ‰å‡½æ•°å¯ä»¥ã€‚å› æ­¤æ— æ³•ç›´æ¥åœ¨ `Redis` ç±»å‹ä¸Šå®šä¹‰æ³›å‹æ–¹æ³•ã€‚

### è§£å†³æ–¹æ¡ˆ
æä¾›ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼š

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨å…¨å±€å‡½æ•°ï¼ˆæ¨èï¼‰
```go
// è®¾ç½®é»˜è®¤è¿æ¥
redisTool.SetDefaultConnection(redis)

// ä½¿ç”¨é»˜è®¤è¿æ¥
typeList := redisTool.NewTypeList[Student]("students")

// æˆ–æŒ‡å®šç‰¹å®šè¿æ¥
typeList := redisTool.NewTypeList[Student]("students", specificRedis)
```

#### æ–¹å¼äºŒï¼šç›´æ¥ä½¿ç”¨ Redis å®ä¾‹
```go
redis := redisTool.Builder("127.0.0.1:6379", "").Build()
list := redis.NewList("mylist")
set := redis.NewSet("myset")
```

### å¯ç”¨çš„å…¨å±€å‡½æ•°

#### æ•°æ®ç»“æ„
- `NewTypeList[T any](name string, r ...*Redis) *RedisTypeList[T]`
- `NewTypeSet[T any](name string, r ...*Redis) *RedisTypeSet[T]`
- `NewTypeMap[T any](name string, r ...*Redis) *RedisTypeMap[T]`
- `NewTypeZSet[T any](name string, r ...*Redis) *RedisTypeZSet[T]`

#### é«˜çº§åŠŸèƒ½
- `NewQueue[T any](name string, config QueueConfig, r ...*Redis) *Queue[T]`
- `NewCache[T any](name string, config CacheConfig, r ...*Redis) *Cache[T]`
- `NewLock(name string, config ...LockConfig) *Lock`

#### è¾…åŠ©å·¥å…·
- `LastUseTime(key string, update bool) time.Time`
- `AcrossMinute(key string) bool`
- `AcrossSecond(key string) bool`
- `AcrossTime(key string, duration time.Duration) bool`
- `SetLastUseTime(key string, t time.Time)`
- `GetSafeTypeMap() *RedisTypeMap[int64]`

## ğŸ§ª æµ‹è¯•è¦†ç›–

### æµ‹è¯•æ–‡ä»¶ï¼ˆå…± 29 ä¸ªæ–‡ä»¶ï¼‰
```
æ ¸å¿ƒå®ç°: 14 ä¸ªæ–‡ä»¶
æµ‹è¯•æ–‡ä»¶:   14 ä¸ªæ–‡ä»¶
æ–‡æ¡£:        3 ä¸ªæ–‡ä»¶ (README.md, TESTING.md, SUMMARY.md)
è„šæœ¬:        2 ä¸ªæ–‡ä»¶ (run_tests.bat, run_tests.sh)
```

### æµ‹è¯•è¦†ç›–åœºæ™¯

#### 1. åŠŸèƒ½æµ‹è¯•
- âœ… æ‰€æœ‰åŸºæœ¬ CRUD æ“ä½œ
- âœ… æ•°æ®ç»“æ„çš„å„ç§æ–¹æ³•
- âœ… ç±»å‹è½¬æ¢å’Œåºåˆ—åŒ–/ååºåˆ—åŒ–

#### 2. è¾¹ç•Œæ¡ä»¶æµ‹è¯•
- âœ… ç©ºæ•°æ®ç»“æ„æ“ä½œ
- âœ… ç´¢å¼•è¶Šç•Œ
- âœ… ä¸å­˜åœ¨çš„é”®
- âœ… è¿‡æœŸæ•°æ®å¤„ç†

#### 3. å¼‚å¸¸æƒ…å†µæµ‹è¯•
- âœ… æ— æ•ˆè¾“å…¥
- âœ… åºåˆ—åŒ–é”™è¯¯
- âœ… ååºåˆ—åŒ–é”™è¯¯
- âœ… é”è¶…æ—¶
- âœ… é˜Ÿåˆ—æ»¡è½½

#### 4. å¹¶å‘æµ‹è¯•
- âœ… åˆ†å¸ƒå¼é”å¹¶å‘è®¿é—®
- âœ… å¤šå·¥ä½œçº¿ç¨‹é˜Ÿåˆ—
- âœ… SafeUpset åŸå­æ“ä½œ
- âœ… ç«æ€æ¡ä»¶æ£€æµ‹ï¼ˆ-race æ ‡å¿—ï¼‰

#### 5. æ€§èƒ½æµ‹è¯•
- âœ… è¿­ä»£å™¨æ‰¹é‡å¤„ç†
- âœ… å¤§æ•°æ®é›†æ“ä½œ
- âœ… è¿‡æœŸæ¸…ç†æ€§èƒ½

### è¿è¡Œæµ‹è¯•

#### Windows
```bash
.\run_tests.bat
```

#### Linux/macOS
```bash
chmod +x run_tests.sh
./run_tests.sh
```

#### æ‰‹åŠ¨è¿è¡Œ
```bash
go test -v -race -coverprofile=coverage.out ./...
go tool cover -html=coverage.out
```

## ğŸ“¦ ä¾èµ–é¡¹

```go
require (
    github.com/alicebob/miniredis/v2 v2.31.0  // æµ‹è¯•ç”¨ Redis æ¨¡æ‹Ÿå™¨
    github.com/gomodule/redigo v1.8.9          // Redis å®¢æˆ·ç«¯
    github.com/google/uuid v1.5.0              // UUID ç”Ÿæˆï¼ˆåˆ†å¸ƒå¼é”ï¼‰
)
```

## ğŸ“š æ–‡æ¡£

### README.md
- åŠŸèƒ½ç‰¹æ€§ä»‹ç»
- å®‰è£…è¯´æ˜
- è¯¦ç»†ä½¿ç”¨ç¤ºä¾‹
- é…ç½®é€‰é¡¹è¯´æ˜
- æ³¨æ„äº‹é¡¹

### TESTING.md
- æµ‹è¯•è¿è¡ŒæŒ‡å—
- miniredis ä½¿ç”¨è¯´æ˜
- å…¨å±€å‡½æ•°ä½¿ç”¨è¯´æ˜
- æµ‹è¯•æœ€ä½³å®è·µ
- CI/CD é›†æˆç¤ºä¾‹

### SUMMARY.mdï¼ˆæœ¬æ–‡æ¡£ï¼‰
- é¡¹ç›®å®Œæˆæ€»ç»“
- åŠŸèƒ½åˆ—è¡¨
- å…¨å±€å‡½æ•°è§£å†³æ–¹æ¡ˆ
- æµ‹è¯•è¦†ç›–æƒ…å†µ

## ğŸ¯ ä»£ç è´¨é‡

### ä»£ç è§„èŒƒ
- âœ… éµå¾ª Go è¯­è¨€æœ€ä½³å®è·µ
- âœ… æ¸…æ™°çš„å‡½æ•°å‘½å
- âœ… å®Œæ•´çš„æ³¨é‡Šæ–‡æ¡£
- âœ… é”™è¯¯å¤„ç†å®Œå–„

### æ€§èƒ½ä¼˜åŒ–
- âœ… è¿æ¥æ± ç®¡ç†
- âœ… æ‰¹é‡æ“ä½œæ”¯æŒ
- âœ… è¿­ä»£å™¨é¿å…å†…å­˜æº¢å‡º
- âœ… Lua è„šæœ¬åŸå­æ“ä½œ

### å®‰å…¨æ€§
- âœ… ç±»å‹å®‰å…¨ï¼ˆæ³›å‹ï¼‰
- âœ… ç«æ€æ¡ä»¶æ£€æµ‹
- âœ… åˆ†å¸ƒå¼é”æœºåˆ¶
- âœ… åŸå­æ“ä½œï¼ˆSafeUpsetï¼‰

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### 1. åˆå§‹åŒ–
```go
// åˆ›å»º Redis å®¢æˆ·ç«¯
redis := redisTool.Builder("127.0.0.1:6379", "password").
    Config(redisTool.Config{
        Prefix: "myapp:",
        MaxIdle: 10,
        MaxActive: 100,
    }).
    Build()

// è®¾ç½®ä¸ºå…¨å±€é»˜è®¤è¿æ¥ï¼ˆæ¨èï¼‰
redisTool.SetDefaultConnection(redis)

// ä¹‹åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨å…¨å±€å‡½æ•°
typeList := redisTool.NewTypeList[Student]("students")
lock := redisTool.NewLock("mylock")
if redisTool.AcrossMinute("task1") {
    // æ‰§è¡Œä»»åŠ¡
}
```

### 2. é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„
- **List** - é˜Ÿåˆ—ã€æ ˆã€æ—¶é—´çº¿
- **Set** - æ ‡ç­¾ã€å»é‡ã€å…³ç³»
- **Map** - ç¼“å­˜ã€ä¼šè¯ã€é…ç½®
- **ZSet** - æ’è¡Œæ¦œã€æ—¶é—´åºåˆ—
- **Queue** - ä»»åŠ¡é˜Ÿåˆ—ã€å¼‚æ­¥å¤„ç†
- **Cache** - ä¸´æ—¶æ•°æ®ã€çƒ­ç‚¹æ•°æ®
- **Lock** - åˆ†å¸ƒå¼äº’æ–¥ã€èµ„æºæ§åˆ¶

### 3. æ€§èƒ½ä¼˜åŒ–
```go
// ä½¿ç”¨è¿­ä»£å™¨å¤„ç†å¤§é‡æ•°æ®
for item := range list.Iterator(100) {
    // æ‰¹é‡å¤„ç†ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®
    process(item)
}

// ä½¿ç”¨ Lua è„šæœ¬ä¿è¯åŸå­æ€§
oldValue, exist, err := typeMap.SafeUpset("key", newValue)
```

### 4. é”™è¯¯å¤„ç†
```go
// æ£€æŸ¥è¿”å›å€¼
value, ok := cache.Get("key")
if !ok {
    // å¤„ç†ä¸å­˜åœ¨çš„æƒ…å†µ
}

// æ£€æŸ¥é”™è¯¯
lock := redisTool.NewLock("mylock")
if err := lock.Lock(); err != nil {
    // å¤„ç†é”è·å–å¤±è´¥
    log.Printf("Failed to acquire lock: %v", err)
    return
}
defer lock.Unlock()

// ä½¿ç”¨é—­åŒ…ç®€åŒ–
redisTool.NewLock("mylock").LockFunc(func() {
    // è‡ªåŠ¨å¤„ç†é”çš„è·å–å’Œé‡Šæ”¾
    // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
})
```

## ğŸš€ åç»­æ”¹è¿›å»ºè®®

### åŠŸèƒ½æ‰©å±•
1. æ·»åŠ  Pub/Sub æ”¯æŒ
2. æ·»åŠ  Stream æ”¯æŒ
3. æ·»åŠ  Geo åœ°ç†ä½ç½®æ”¯æŒ
4. æ·»åŠ  HyperLogLog æ”¯æŒ
5. æ·»åŠ é›†ç¾¤æ”¯æŒ

### æ€§èƒ½ä¼˜åŒ–
1. æ·»åŠ æœ¬åœ°ç¼“å­˜å±‚
2. ä¼˜åŒ–è¿æ¥æ± ç­–ç•¥
3. æ·»åŠ æ…¢æŸ¥è¯¢ç›‘æ§
4. æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•

### å¯è§‚æµ‹æ€§
1. æ·»åŠ  metrics æŒ‡æ ‡
2. æ·»åŠ åˆ†å¸ƒå¼è¿½è¸ª
3. æ·»åŠ æ—¥å¿—è®°å½•
4. æ·»åŠ å¥åº·æ£€æŸ¥

## ğŸ“Š ç»Ÿè®¡ä¿¡æ¯

```
æ€»ä»£ç è¡Œæ•°:    ~3000+ è¡Œ
æµ‹è¯•ä»£ç è¡Œæ•°:  ~5000+ è¡Œ
ä»£ç è¦†ç›–ç‡:    â‰¥ 90%
æµ‹è¯•ç”¨ä¾‹æ•°:    ~200+ ä¸ª
æ–‡æ¡£é¡µæ•°:      3 ä¸ªæ–‡æ¡£
```

## âœ¨ äº®ç‚¹ç‰¹æ€§

1. **å®Œå…¨ç±»å‹å®‰å…¨** - æ³›å‹æ”¯æŒï¼Œç¼–è¯‘æ—¶æ£€æŸ¥
2. **çµæ´»çš„ä½¿ç”¨æ–¹å¼** - å®ä¾‹æ–¹æ³• + å…¨å±€å‡½æ•°
3. **å…¨å±€é»˜è®¤è¿æ¥** - ä¸€æ¬¡è®¾ç½®ï¼Œå¤„å¤„ä½¿ç”¨
4. **å®Œå–„çš„æµ‹è¯•** - é«˜è¦†ç›–ç‡ï¼Œå¤šç§åœºæ™¯
5. **è¯¦ç»†çš„æ–‡æ¡£** - ä½¿ç”¨ç¤ºä¾‹ï¼Œæœ€ä½³å®è·µ
6. **ç”Ÿäº§å°±ç»ª** - é”™è¯¯å¤„ç†ï¼Œå¹¶å‘å®‰å…¨

## ğŸ‰ æ€»ç»“

Redis å·¥å…·åº“å·²å®Œå…¨å®ç°ï¼Œå…·å¤‡ï¼š
- âœ… å®Œæ•´çš„åŠŸèƒ½å®ç°
- âœ… é«˜è´¨é‡çš„ä»£ç 
- âœ… å®Œå–„çš„å•å…ƒæµ‹è¯•ï¼ˆâ‰¥ 90% è¦†ç›–ç‡ï¼‰
- âœ… è¯¦ç»†çš„æ–‡æ¡£
- âœ… ç”Ÿäº§ç¯å¢ƒå°±ç»ª

å¯ä»¥ç›´æ¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ï¼
